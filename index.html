<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Willow</title>
    <meta name="description" content="A safe space for your never-ending thoughts. Willow is a macOS app for freeform thinking.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="assets/icon.png">
</head>
<body>
    <main class="snap-container">
        <section class="snap-section">
            <h2>HAVE YOU EVER</h2>
        </section>

        <section class="snap-section">
            <div class="section-content">
                <p>LEFT A MOVIE THEATER : MESMERIZED</p>
                <br />
                <p>CLOSED A BOOK : FASCINATED</p>
                <br />
                <p>ENVISIONED A FUTURE : INSPIRED</p>
            </div>
        </section>

        <section class="snap-section">
            <p>AND IN THESE MOMENTS<span class="dots"><span class="dot dot-1">.</span><span class="dot dot-2">.</span><span class="dot dot-3">.</span></span> WANTED TO</p>
        </section>

        <section class="snap-section">
            <p style="text-align: right";><span class="ramble-hover" id="ramble-text">ramble?</span></p>
        </section>

        <section class="snap-section">
            <p>so have we.</p>
        </section>

        <section class="snap-section">
            <p style="text-align: center;">that's why we built [willow]</p>
        </section>

        <section class="snap-section">
            <div class="section-content">
                <p>a safe space for your never-ending thoughts</p>
                <br />
                <p>bc your mind is the ultimate playground.</p>
            </div>
        </section>

        <section class="snap-section">
            <form id="waitlist-form" class="waitlist-form">
                <input type="email" name="email" placeholder="your email" required>
                <button type="submit">join waitlist</button>
            </form>
            <p id="form-message" class="form-message"></p>
            <footer>
                <p>&copy; 2025 Willow &middot; <a href="privacy.html">Privacy</a></p>
            </footer>
        </section>
    </main>

    <script>
        const form = document.getElementById('waitlist-form');
        const message = document.getElementById('form-message');

        // Replace this URL with your Google Apps Script web app URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw9V0glE78xrIek0leCYnXl-BeNPfXsIAHrNlHZe4Vg6k6nyr9oCxvj3c_l5GozX7vx/exec';

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = form.email.value;
            const button = form.querySelector('button');

            button.disabled = true;
            button.textContent = 'joining...';

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email })
                });

                form.style.display = 'none';
                message.textContent = "you're on the list! ðŸ’›";
                message.style.color = '#333';
            } catch (error) {
                message.textContent = 'something went wrong. try again?';
                message.style.color = '#c00';
                button.disabled = false;
                button.textContent = 'join waitlist';
            }
        });
    </script>

    <script>
        const randomTexts = ["the epicness of oppenheimer...", "day 2 of building a virtual dj", "@#%%^!$", "&^%$#&*%$#$",
        "journal entry: 10 red-tailed hawks spotted!", "tomorrow, and tomorrow, and tomorrow - thoughts", "coachella: colors"];
        let typingElements = [];
        let isRambleActive = false;
        let availableTexts = [...randomTexts];
        let spawnInterval = null;

        // Collision detection helpers
        function rectsOverlap(r1, r2) {
            return !(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom);
        }

        function getOccupiedRegions() {
            const regions = [];

            // Add ramble text bounding box
            const rambleEl = document.getElementById('ramble-text');
            if (rambleEl) {
                const rect = rambleEl.getBoundingClientRect();
                regions.push({
                    left: rect.left - 20,
                    right: rect.right + 20,
                    top: rect.top - 10,
                    bottom: rect.bottom + 10
                });
            }

            // Add existing typing elements
            typingElements.forEach(el => {
                const rect = el.getBoundingClientRect();
                regions.push({
                    left: rect.left - 10,
                    right: rect.right + 10,
                    top: rect.top - 5,
                    bottom: rect.bottom + 5
                });
            });

            return regions;
        }

        function findNonOverlappingPosition(textWidth, textHeight) {
            const occupied = getOccupiedRegions();
            const padding = 20;

            // Try up to 50 random positions
            for (let attempt = 0; attempt < 50; attempt++) {
                const x = 50 + Math.random() * (window.innerWidth - textWidth - 100);
                const y = window.innerHeight * 0.2 + Math.random() * (window.innerHeight * 0.6 - textHeight);

                const proposedRect = {
                    left: x,
                    right: x + textWidth + padding,
                    top: y,
                    bottom: y + textHeight + padding
                };

                let overlaps = false;
                for (const region of occupied) {
                    if (rectsOverlap(proposedRect, region)) {
                        overlaps = true;
                        break;
                    }
                }

                if (!overlaps) {
                    return { x, y };
                }
            }

            // Fallback to random position if no non-overlapping position found
            return {
                x: 50 + Math.random() * (window.innerWidth - 400),
                y: window.innerHeight * 0.2 + Math.random() * (window.innerHeight * 0.6)
            };
        }

        function getNextText() {
            if (availableTexts.length === 0) {
                availableTexts = [...randomTexts];
            }
            const index = Math.floor(Math.random() * availableTexts.length);
            return availableTexts.splice(index, 1)[0];
        }

        function createTypingElement() {
            if (!isRambleActive) return;

            const fullText = getNextText();

            // Estimate text dimensions (~10px per char for 16px monospace, ~24px height)
            const estimatedWidth = fullText.length * 10;
            const estimatedHeight = 24;

            // Find non-overlapping position
            const pos = findNonOverlappingPosition(estimatedWidth, estimatedHeight);

            const container = document.createElement('div');
            container.className = 'typing-container';
            container.style.left = pos.x + 'px';
            container.style.top = pos.y + 'px';

            // Random gray color
            const gray = Math.floor(100 + Math.random() * 100);
            container.style.color = `rgb(${gray}, ${gray}, ${gray})`;

            const textSpan = document.createElement('span');
            textSpan.className = 'typing-text';
            const cursorSpan = document.createElement('span');
            cursorSpan.className = 'typing-cursor';
            cursorSpan.textContent = '|';

            container.appendChild(textSpan);
            container.appendChild(cursorSpan);
            document.body.appendChild(container);
            typingElements.push(container);
            let charIndex = 0;

            function typeChar() {
                if (!isRambleActive || charIndex >= fullText.length) {
                    if (charIndex >= fullText.length) {
                        // Finished typing, fade out after a pause
                        setTimeout(() => {
                            container.classList.add('fade-out');
                            setTimeout(() => {
                                container.remove();
                                typingElements = typingElements.filter(el => el !== container);
                            }, 1000);
                        }, 1500);
                    }
                    return;
                }
                textSpan.textContent = fullText.substring(0, charIndex + 1);
                charIndex++;
                setTimeout(typeChar, 40 + Math.random() * 60);
            }

            typeChar();
        }

        function startTyping() {
            if (isRambleActive) return;
            isRambleActive = true;
            document.body.classList.add('ramble-active');
            createTypingElement();
            spawnInterval = setInterval(() => {
                if (isRambleActive && typingElements.length < 4) {
                    createTypingElement();
                }
            }, 800);
        }

        function stopTyping() {
            isRambleActive = false;
            document.body.classList.remove('ramble-active');
            clearInterval(spawnInterval);
            typingElements.forEach(el => {
                el.classList.add('fade-out');
                setTimeout(() => el.remove(), 1000);
            });
            typingElements = [];
        }
    </script>

    <script>
        const snapContainer = document.querySelector('.snap-container');
        const sections = document.querySelectorAll('.snap-section');
        let currentSection = 0;
        let isScrolling = false;

        // Mobile detection
        function isMobile() {
            return window.matchMedia('(max-width: 600px)').matches;
        }

        // Initialize first section on load
        document.addEventListener('DOMContentLoaded', () => {
            sections[0].classList.add('active');
            currentSection = 0;
        });

        // Navigate to a specific section with fade transition
        function scrollToSection(index) {
            if (index < 0 || index >= sections.length || isScrolling) return;
            if (index === currentSection) return;

            // If navigating to last section, expand to show all as a single page
            if (index === sections.length - 1) {
                isScrolling = true;
                sections[currentSection].classList.remove('active');
                snapContainer.classList.add('expanded');
                if (isMobile()) stopTyping(); // Stop ramble effect when entering expanded mode
                setTimeout(() => {
                    isScrolling = false;
                }, 100);
                return;
            }

            // If coming back from expanded mode
            if (snapContainer.classList.contains('expanded')) {
                snapContainer.classList.remove('expanded');
                window.scrollTo({ top: 0 });
            }

            isScrolling = true;

            // Fade out current section
            sections[currentSection].classList.remove('active');

            // Fade in new section
            currentSection = index;
            sections[currentSection].classList.add('active');

            // Auto-trigger ramble effect on mobile when entering section 3
            if (isMobile()) {
                if (currentSection === 3) {
                    startTyping();
                } else {
                    stopTyping();
                }
            }

            setTimeout(() => {
                isScrolling = false;
            }, 600);
        }

        // Handle wheel events
        snapContainer.addEventListener('wheel', (e) => {
            e.preventDefault();

            // In expanded mode, scroll up to collapse back
            if (snapContainer.classList.contains('expanded')) {
                if (e.deltaY < 0) {
                    snapContainer.classList.remove('expanded');
                    currentSection = sections.length - 2;
                    sections[currentSection].classList.add('active');
                }
                return;
            }

            if (isScrolling) return;

            if (e.deltaY > 0) {
                scrollToSection(currentSection + 1);
            } else {
                scrollToSection(currentSection - 1);
            }
        }, { passive: false });

        // Handle touch events for mobile
        let touchStartY = 0;
        let touchEndY = 0;

        snapContainer.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        }, { passive: true });

        snapContainer.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        snapContainer.addEventListener('touchend', (e) => {
            touchEndY = e.changedTouches[0].clientY;
            const diff = touchStartY - touchEndY;

            // In expanded mode, swipe down to collapse back
            if (snapContainer.classList.contains('expanded')) {
                if (diff < -50) {
                    snapContainer.classList.remove('expanded');
                    currentSection = sections.length - 2;
                    sections[currentSection].classList.add('active');
                }
                return;
            }

            // On mobile, use click instead of swipe for navigation
            if (isMobile()) return;

            if (Math.abs(diff) > 50) { // Minimum swipe distance
                if (diff > 0) {
                    scrollToSection(currentSection + 1);
                } else {
                    scrollToSection(currentSection - 1);
                }
            }
        }, { passive: true });

        // Handle keyboard navigation
        document.addEventListener('keydown', (e) => {
            // In expanded mode, up arrow to collapse back
            if (snapContainer.classList.contains('expanded')) {
                if (e.key === 'ArrowUp' || e.key === 'PageUp') {
                    e.preventDefault();
                    snapContainer.classList.remove('expanded');
                    currentSection = sections.length - 2;
                    sections[currentSection].classList.add('active');
                }
                return;
            }

            if (e.key === 'ArrowDown' || e.key === 'PageDown') {
                e.preventDefault();
                scrollToSection(currentSection + 1);
            } else if (e.key === 'ArrowUp' || e.key === 'PageUp') {
                e.preventDefault();
                scrollToSection(currentSection - 1);
            }
        });

        // Click-to-navigate on mobile
        snapContainer.addEventListener('click', (e) => {
            if (!isMobile()) return;
            if (snapContainer.classList.contains('expanded')) return;
            if (e.target.closest('form, footer, a, button, input')) return;

            scrollToSection(currentSection + 1);
        });

        // Ramble hover handler
        const rambleText = document.getElementById('ramble-text');
        rambleText.addEventListener('mouseenter', startTyping);
        rambleText.addEventListener('mouseleave', stopTyping);
    </script>

</body>
</html>
