<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Willow</title>
    <meta name="description" content="A safe space for your never-ending thoughts. Willow is a macOS app for freeform thinking.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="assets/icon.png">
</head>
<body>
    <main>
        <div class="tagline">
            <p>willow <span class="icon-container"><img src="assets/bnwIcon.png" alt="Willow" class="icon icon-default"><img src="assets/willow_nobackground.png" alt="Willow" class="icon icon-hover"></span> for people who think in webs but are forced to write in lines</p>
        </div>
        <form id="waitlist-form" class="waitlist-form">
            <input type="email" name="email" placeholder="your email" required class="hidden">
            <button type="submit">join waitlist</button>
            <p id="form-message" class="form-message"></p>
        </form>
    </main>
    <footer>
        <p>&copy; 2025 Audrey Fan &middot; <a href="privacy.html">Privacy</a></p>
    </footer>

    <script>
        const form = document.getElementById('waitlist-form');
        const message = document.getElementById('form-message');
        const emailInput = form.querySelector('input[name="email"]');
        const button = form.querySelector('button');

        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw9V0glE78xrIek0leCYnXl-BeNPfXsIAHrNlHZe4Vg6k6nyr9oCxvj3c_l5GozX7vx/exec';

        // Handle button click to reveal input
        button.addEventListener('click', (e) => {
            if (emailInput.classList.contains('hidden')) {
                e.preventDefault();
                emailInput.classList.remove('hidden');
                emailInput.focus();
            }
        });

        // Handle form submit
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = emailInput.value;
            button.disabled = true;
            button.textContent = 'joining...';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);

                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                emailInput.style.display = 'none';
                button.style.display = 'none';
                message.textContent = "you're on the list! we'll be in touch soon.";
                message.style.color = '#333';
                message.style.fontSize = '14px';
                document.querySelector('.icon-container').classList.add('success');
            } catch (error) {
                if (error.name === 'AbortError') {
                    // Request timed out, but likely still went through
                    emailInput.style.display = 'none';
                    button.style.display = 'none';
                    message.textContent = "you're on the list! we'll be in touch soon.";
                    message.style.color = '#000000';
                    message.style.fontSize = '14px';
                    document.querySelector('.icon-container').classList.add('success');
                } else {
                    message.textContent = 'something went wrong. try again?';
                    message.style.color = '#c00';
                    message.style.fontSize = '14px';
                    button.disabled = false;
                    button.textContent = 'join waitlist';
                }
            }
        });
    </script>

</body>
</html>
